name: loki
namespace: loki
components:
  - name: loki-distributor
    workloadType: deployment
    labels:
      app.kubernetes.io/component: distributor
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-distributor
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-distributor%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-distributor
      labelSets:
        - labels:
            destination_service_name: loki-distributor
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-distributor
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-distributor
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: distributor
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-query-frontend
    workloadType: deployment
    labels:
      app.kubernetes.io/component: query-frontend
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-query-frontend
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-query-frontend%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-query-frontend
      labelSets:
        - labels:
            destination_service_name: loki-query-frontend
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-query-frontend
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-query-frontend
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: query-frontend
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-query-scheduler
    workloadType: deployment
    labels:
      app.kubernetes.io/component: query-scheduler
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-query-scheduler
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-query-scheduler%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-query-scheduler
      labelSets:
        - labels:
            destination_service_name: loki-query-scheduler
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-query-scheduler
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-query-scheduler
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: query-scheduler
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-querier
    workloadType: deployment
    labels:
      app.kubernetes.io/component: querier
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-querier
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-querier%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-querier
      labelSets:
        - labels:
            destination_service_name: loki-querier
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-querier
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-querier
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: querier
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-proxy
    workloadType: deployment
    labels:
      app.kubernetes.io/component: proxy
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-proxy
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-proxy%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-proxy
      labelSets:
        - labels:
            destination_service_name: loki-proxy
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-proxy
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-proxy
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: proxy
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-mcrouter
    workloadType: deployment
    labels:
      app.kubernetes.io/component: mcrouter
      app.kubernetes.io/name: loki
      variant: utilities
    logs:
      grouping: kubernetes.loki.loki-mcrouter
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-mcrouter%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=deployment&var-workload=loki-mcrouter
      labelSets:
        - labels:
            destination_service_name: loki-mcrouter
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-mcrouter
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-mcrouter
            workload_type: deployment
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: mcrouter
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-compactor
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: compactor
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-compactor
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-compactor%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-compactor
      labelSets:
        - labels:
            destination_service_name: loki-compactor
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-compactor
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-compactor
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: compactor
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-ingester
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: ingester
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-ingester
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-ingester%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-ingester
      labelSets:
        - labels:
            destination_service_name: loki-ingester
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-ingester
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-ingester
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: ingester
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-index-gateway
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: index-gateway
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-index-gateway
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-index-gateway%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-index-gateway
      labelSets:
        - labels:
            destination_service_name: loki-index-gateway
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-index-gateway
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-index-gateway
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: index-gateway
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-ruler
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: ruler
      app.kubernetes.io/name: loki
    logs:
      grouping: kubernetes.loki.loki-ruler
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-ruler%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-ruler
      labelSets:
        - labels:
            destination_service_name: loki-ruler
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-ruler
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-ruler
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: ruler
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-memcached
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: memcached
      app.kubernetes.io/name: loki
      variant: utilities
    logs:
      grouping: kubernetes.loki.loki-memcached
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-memcached%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-memcached
      labelSets:
        - labels:
            destination_service_name: loki-memcached
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-memcached
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-memcached
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: memcached
            app_kubernetes_io_name: loki
            namespace: loki
  - name: loki-minio
    workloadType: statefulset
    labels:
      app.kubernetes.io/component: minio
      app.kubernetes.io/name: loki
      variant: utilities
    logs:
      grouping: kubernetes.loki.loki-minio
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.loki.loki-minio%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=loki&var-workload_type=statefulset&var-workload=loki-minio
      labelSets:
        - labels:
            destination_service_name: loki-minio
            destination_service_namespace: loki
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: loki-minio
            source_workload_namespace: loki
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            namespace: loki
            workload: loki-minio
            workload_type: statefulset
          queries:
            - name: CPU Usage
              template: sum by (pod) (rate(container_cpu_usage_seconds_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: CPU Throttled
              template: sum by (pod) (rate(container_cpu_cfs_throttled_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>}) / sum by (pod) (rate(container_cpu_cfs_periods_total{container!=""}[5m]) * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
            - name: Memory Working Set
              template: sum by (pod) (container_memory_working_set_bytes{container!=""} * on(namespace,pod) group_left() mixin_pod_workload{<<.LabelMatchers>>})
        - labels:
            app_kubernetes_io_component: minio
            app_kubernetes_io_name: loki
            namespace: loki
