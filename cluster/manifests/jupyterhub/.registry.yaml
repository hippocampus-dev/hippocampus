name: jupyterhub
namespace: jupyterhub
components:
  - name: jupyterhub-proxy
    labels:
      app.kubernetes.io/component: proxy
      app.kubernetes.io/name: jupyterhub
    logs:
      grouping: kubernetes.jupyterhub.jupyterhub-proxy
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.jupyterhub.jupyterhub-proxy%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=jupyterhub&var-workload_type=deployment&var-workload=jupyterhub-proxy
      labelSets:
        - labels:
            destination_service_name: jupyterhub-proxy
            destination_service_namespace: jupyterhub
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: jupyterhub-proxy
            source_workload_namespace: jupyterhub
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            app_kubernetes_io_component: proxy
            app_kubernetes_io_name: jupyterhub
            namespace: jupyterhub
  - name: jupyterhub-redis-haproxy
    labels:
      app.kubernetes.io/component: redis-haproxy
      app.kubernetes.io/name: jupyterhub
      variant: utilities
    logs:
      grouping: kubernetes.jupyterhub.jupyterhub-redis-haproxy
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.jupyterhub.jupyterhub-redis-haproxy%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=jupyterhub&var-workload_type=deployment&var-workload=jupyterhub-redis-haproxy
      labelSets:
        - labels:
            destination_service_name: jupyterhub-redis-haproxy
            destination_service_namespace: jupyterhub
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: jupyterhub-redis-haproxy
            source_workload_namespace: jupyterhub
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            app_kubernetes_io_component: redis-haproxy
            app_kubernetes_io_name: jupyterhub
            namespace: jupyterhub
  - name: jupyterhub-hub
    labels:
      app.kubernetes.io/component: hub
      app.kubernetes.io/name: jupyterhub
    logs:
      grouping: kubernetes.jupyterhub.jupyterhub-hub
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.jupyterhub.jupyterhub-hub%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=jupyterhub&var-workload_type=statefulset&var-workload=jupyterhub-hub
      labelSets:
        - labels:
            destination_service_name: jupyterhub-hub
            destination_service_namespace: jupyterhub
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: jupyterhub-hub
            source_workload_namespace: jupyterhub
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            app_kubernetes_io_component: hub
            app_kubernetes_io_name: jupyterhub
            namespace: jupyterhub
  - name: jupyterhub-redis
    labels:
      app.kubernetes.io/component: redis
      app.kubernetes.io/name: jupyterhub
      variant: utilities
    logs:
      grouping: kubernetes.jupyterhub.jupyterhub-redis
      link: https://grafana.minikube.127.0.0.1.nip.io/explore?schemaVersion=1&panes=%7B%22default%22%3A%7B%22datasource%22%3A%22loki%22%2C%22queries%22%3A%5B%7B%22expr%22%3A%22%7Bgrouping%3D%5C%22kubernetes.jupyterhub.jupyterhub-redis%5C%22%7D%22%7D%5D%7D%7D
    metrics:
      link: https://grafana.minikube.127.0.0.1.nip.io/d/workload/workload?orgId=1&var-namespace=jupyterhub&var-workload_type=statefulset&var-workload=jupyterhub-redis
      labelSets:
        - labels:
            destination_service_name: jupyterhub-redis
            destination_service_namespace: jupyterhub
          queries:
            - name: Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (response_code)
            - name: Error Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>,response_code=~"5.*"}[5m]))
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            source_workload: jupyterhub-redis
            source_workload_namespace: jupyterhub
          queries:
            - name: Outbound Request Rate
              template: sum(rate(istio_requests_total{<<.LabelMatchers>>}[5m])) by (destination_service_name)
            - name: P99 Latency
              template: histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket{<<.LabelMatchers>>}[5m])) by (le))
        - labels:
            app_kubernetes_io_component: redis
            app_kubernetes_io_name: jupyterhub
            namespace: jupyterhub
