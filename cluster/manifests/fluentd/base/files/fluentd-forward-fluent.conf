<source>
  @type prometheus
</source>

<source>
  @type monitor_agent
</source>

<source>
  @type prometheus_monitor
</source>

<source>
  @type prometheus_output_monitor
</source>

<source>
  @type prometheus_tail_monitor
</source>

@include systemd.conf
@include kubernetes.conf

<source>
  @type tail
  path /var/run/cilium/hubble/events.log
  pos_file /var/run/cilium/hubble/events.log.pos
  tag cilium.hubble.events
  <parse>
    @type json
    time_type string
    time_format %iso8601
  </parse>
</source>

<match **>
  @type forward
  compress gzip
  <server>
    host "#{ENV['FLUENT_FORWARD_HOST']}"
    port "#{ENV['FLUENT_FORWARD_PORT']}"
  </server>
  <buffer>
    @type file
    path /var/log/fluent/forward.buffer
    flush_mode interval
    flush_interval 10s
    flush_at_shutdown true
    retry_type exponential_backoff
    retry_max_interval 300
    retry_forever true
    overflow_action block
  </buffer>
</match>
