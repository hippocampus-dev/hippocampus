apiVersion: batch/v1
kind: CronJob
metadata:
  name: descheduler
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  successfulJobsHistoryLimit: 3
  startingDeadlineSeconds: 600
  schedule: "*/10 * * * *"
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 3600
      completions: 1
      parallelism: 1
      completionMode: Indexed
      backoffLimitPerIndex: 6
      maxFailedIndexes: 1
      podReplacementPolicy: Failed
      podFailurePolicy:
        rules:
          - action: Ignore
            onPodConditions:
              - type: DisruptionTarget
                status: "True"
      template:
        metadata:
          labels:
            app.kubernetes.io/name: descheduler
            app.kubernetes.io/component: ""
        spec:
          serviceAccountName: descheduler-sa
          restartPolicy: Never
          securityContext:
            seccompProfile:
              type: RuntimeDefault
          containers:
            - name: descheduler
              securityContext:
                privileged: false
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                    - ALL
                readOnlyRootFilesystem: true
                runAsUser: 65532
                runAsNonRoot: true
                seccompProfile:
                  type: RuntimeDefault
              image: registry.k8s.io/descheduler/descheduler
              imagePullPolicy: IfNotPresent
