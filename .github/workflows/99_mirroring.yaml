name: Mirror docker images
on:
  push:
    branches:
      - main
    paths:
      - ".github/workflows/99_mirroring.yaml"
  workflow_dispatch:
    inputs: {}
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
permissions:
  contents: write
  packages: write
  pull-requests: write
env:
  GITHUB_TOKEN: ${{ github.token }}
jobs:
  etcd:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/coreos/etcd
      TAG: v3.5.16
      KUSTOMIZATION: cluster/manifests/cilium-etcd/base,cluster/manifests/utilities/etcd
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/cilium-etcd/base/
            cluster/manifests/utilities/etcd/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  redis:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: redis
      TAG: 7.2.5
      KUSTOMIZATION: cluster/manifests/exactly-one-pod-hook/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/exactly-one-pod-hook/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  redis-stack:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: redis/redis-stack
      TAG: 7.4.0-v0
      KUSTOMIZATION: cluster/manifests/utilities/redis
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/redis/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  redis-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: oliver006/redis_exporter
      TAG: v1.62.0
      KUSTOMIZATION: cluster/manifests/utilities/redis
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/redis/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  redis-sentinel-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: leominov/redis_sentinel_exporter
      TAG: latest
      KUSTOMIZATION: cluster/manifests/utilities/redis
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/redis/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  haproxy:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: haproxy
      TAG: 3.0.3
      KUSTOMIZATION: cluster/manifests/utilities/redis
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/redis/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  haproxy-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/prometheus/haproxy-exporter
      TAG: v0.15.0
      KUSTOMIZATION: cluster/manifests/utilities/redis
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/redis/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  atlas-operator:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: arigaio/atlas-operator
      TAG: 0.7.11
      KUSTOMIZATION: cluster/manifests/atlas-operator/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/atlas-operator/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mysql:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: mysql
      TAG: "8"
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  blackbox-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/prometheus/blackbox-exporter
      TAG: v0.25.0
      KUSTOMIZATION: cluster/manifests/blackbox-exporter/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/blackbox-exporter/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  tidb-operator:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/tidb-operator
      TAG: v1.6.3
      KUSTOMIZATION: cluster/manifests/tidb-operator/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/tidb-operator/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  tidb-backup-manager:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/tidb-backup-manager
      TAG: v1.6.3
      KUSTOMIZATION: cluster/manifests/tidb-operator/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/tidb-operator/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  pd:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/pd
      TAG: v8.5.0
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  tidb:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/tidb
      TAG: v8.5.0
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  tikv:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/tikv
      TAG: v8.5.0
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  ticdc:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: pingcap/ticdc
      TAG: v8.5.0
      KUSTOMIZATION: cluster/manifests/slack-logger/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/slack-logger/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  memcached:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: memcached
      TAG: 1.6.29
      KUSTOMIZATION: cluster/manifests/utilities/memcached
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/memcached/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  memcached-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/prometheus/memcached-exporter
      TAG: v0.14.4
      KUSTOMIZATION: cluster/manifests/utilities/memcached
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/memcached/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mcrouter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/evryfs/docker-mcrouter
      TAG: 0.40.0-9
      KUSTOMIZATION: cluster/manifests/utilities/memcached
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/memcached/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mcrouter-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/dev25/mcrouter_exporter
      TAG: 0.4.0
      KUSTOMIZATION: cluster/manifests/utilities/memcached
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/memcached/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  minio:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: minio/minio
      TAG: RELEASE.2023-05-04T21-44-30Z
      KUSTOMIZATION: cluster/manifests/utilities/minio
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/minio/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mc:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: minio/mc
      TAG: RELEASE.2023-05-04T18-10-16Z
      KUSTOMIZATION: cluster/manifests/mimir/overlays/dev,cluster/manifests/loki/overlays/dev,cluster/manifests/tempo/overlays/dev,cluster/manifests/pyroscope/overlays/dev,cluster/manifests/cortex-bot/overlays/dev,cluster/manifests/embedding-gateway/overlays/dev,cluster/manifests/whisper-worker/overlays/dev,cluster/manifests/assets/overlays/dev,cluster/manifests/http-kvs/overlays/dev,cluster/manifests/kube-crud-server/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/mimir/overlays/dev/
            cluster/manifests/loki/overlays/dev/
            cluster/manifests/tempo/overlays/dev/
            cluster/manifests/pyroscope/overlays/dev/
            cluster/manifests/cortex-bot/overlays/dev/
            cluster/manifests/embedding-gateway/overlays/dev/
            cluster/manifests/whisper-worker/overlays/dev/
            cluster/manifests/assets/overlays/dev/
            cluster/manifests/http-kvs/overlays/dev/
            cluster/manifests/kube-crud-server/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  httpbin:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: kennethreitz/httpbin
      TAG: latest
      KUSTOMIZATION: cluster/manifests/utilities/httpbin
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/httpbin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  opentelemetry-collector:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: otel/opentelemetry-collector-contrib
      TAG: 0.77.0
      KUSTOMIZATION: cluster/manifests/otel-agent/base,cluster/manifests/otel-collector/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/otel-agent/base/
            cluster/manifests/otel-collector/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  oauth2-proxy:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/oauth2-proxy/oauth2-proxy
      TAG: v7.4.0
      KUSTOMIZATION: cluster/manifests/oauth2-proxy/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/oauth2-proxy/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  grafana:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: grafana/grafana
      TAG: 11.6.1
      KUSTOMIZATION: cluster/manifests/grafana/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/grafana/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mcp-grafana:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: mcp/grafana
      TAG: latest
      KUSTOMIZATION: cluster/manifests/grafana/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/grafana/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  tempo:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: grafana/tempo
      TAG: 2.7.2
      KUSTOMIZATION: cluster/manifests/tempo/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/tempo/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  loki:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: grafana/loki
      TAG: 3.5.0
      KUSTOMIZATION: cluster/manifests/loki/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/loki/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mimir:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: grafana/mimir
      TAG: 2.16.0
      KUSTOMIZATION: cluster/manifests/mimir/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/mimir/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  vault:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: vault
      TAG: 1.13.2
      KUSTOMIZATION: cluster/manifests/vault/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/vault/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  argocd:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/argoproj/argocd
      TAG: v2.14.15
      KUSTOMIZATION: cluster/manifests/argocd/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/argocd/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  golang:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: golang
      TAG: 1.25-bookworm
      KUSTOMIZATION: cluster/manifests/argocd/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/argocd/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  fluentd:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: fluent/fluentd
      TAG: v1.17-debian-1
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  fluentd-kubernetes-daemonset:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: fluent/fluentd-kubernetes-daemonset
      TAG: v1.17-debian-forward-1
      KUSTOMIZATION: cluster/manifests/fluentd/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/fluentd/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  qdrant:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: qdrant/qdrant
      TAG: v1.10.0
      KUSTOMIZATION: cluster/manifests/utilities/qdrant
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/qdrant/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cert-manager-cainjector:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/jetstack/cert-manager-cainjector
      TAG: v1.12.0
      KUSTOMIZATION: cluster/manifests/cert-manager/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/cert-manager/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cert-manager-controller:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/jetstack/cert-manager-controller
      TAG: v1.12.0
      KUSTOMIZATION: cluster/manifests/cert-manager/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/cert-manager/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cert-manager-webhook:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/jetstack/cert-manager-webhook
      TAG: v1.12.0
      KUSTOMIZATION: cluster/manifests/cert-manager/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/cert-manager/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  metrics-server:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/metrics-server/metrics-server
      TAG: v0.6.3
      KUSTOMIZATION: cluster/manifests/metrics-server/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/metrics-server/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  addon-resizer:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: gcr.io/google-containers/addon-resizer-amd64
      TAG: 2.3
      KUSTOMIZATION: cluster/manifests/metrics-server/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/metrics-server/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  node-problem-detector:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/node-problem-detector/node-problem-detector
      TAG: v0.8.7
      KUSTOMIZATION: cluster/manifests/node-problem-detector/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/node-problem-detector/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  kube-state-metrics:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/kube-state-metrics/kube-state-metrics
      TAG: v2.17.0
      KUSTOMIZATION: cluster/manifests/kube-state-metrics/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/kube-state-metrics/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  node-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/prometheus/node-exporter
      TAG: v1.6.0
      KUSTOMIZATION: cluster/manifests/node-exporter/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/node-exporter/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  node-local-dns:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/dns/k8s-dns-node-cache
      TAG: 1.22.20
      KUSTOMIZATION: cluster/manifests/node-local-dns/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/node-local-dns/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cluster-proportional-autoscaler:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/cpa/cluster-proportional-autoscaler
      TAG: 1.8.6
      KUSTOMIZATION: cluster/manifests/dns-autoscaler/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/dns-autoscaler/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  jupyterhub-istio-proxy:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: splunk/jupyterhub-istio-proxy
      TAG: 0.3.0
      KUSTOMIZATION: cluster/manifests/jupyterhub/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/jupyterhub/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  prometheus:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: prom/prometheus
      TAG: v3.8.1
      KUSTOMIZATION: cluster/manifests/prometheus/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/prometheus/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  nginx:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: nginx
      TAG: 1.27.3-bookworm
      KUSTOMIZATION: cluster/manifests/fluentd/base,cluster/manifests/mimir/base,cluster/manifests/loki/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/fluentd/base/
            cluster/manifests/mimir/base/
            cluster/manifests/loki/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cadvisor:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: gcr.io/cadvisor/cadvisor
      TAG: v0.47.2
      KUSTOMIZATION: cluster/manifests/additional-cadvisor/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/additional-cadvisor/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  cfssl:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: cfssl/cfssl
      TAG: v1.6.4
      KUSTOMIZATION: cluster/manifests/prometheus-adapter/base,cluster/manifests/vpa/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/prometheus-adapter/base/
            cluster/manifests/vpa/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  prometheus-adapter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/prometheus-adapter/prometheus-adapter
      TAG: v0.11.2
      KUSTOMIZATION: cluster/manifests/prometheus-adapter/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/prometheus-adapter/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  kubectl:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: bitnami/kubectl
      TAG: 1.29.3
      KUSTOMIZATION: cluster/manifests/github-actions-runner-controller/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/github-actions-runner-controller/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  registry:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry
      TAG: 2
      KUSTOMIZATION: cluster/manifests/github-actions-runner-controller/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/github-actions-runner-controller/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  k6-operator:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: ghcr.io/grafana/k6-operator
      TAG: controller-v0.0.14
      KUSTOMIZATION: cluster/manifests/k6-operator/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/k6-operator/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  ratelimit:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: envoyproxy/ratelimit
      TAG: 91484c59
      KUSTOMIZATION: cluster/manifests/envoy-ratelimit/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/envoy-ratelimit/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  statsd-exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: prom/statsd-exporter
      TAG: v0.28.0
      KUSTOMIZATION: cluster/manifests/utilities/statsd-exporter
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/statsd-exporter/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  varnish:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: varnish
      TAG: 7.6
      KUSTOMIZATION: cluster/manifests/utilities/varnish
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/varnish/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  vpa-admission-controller:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/autoscaling/vpa-admission-controller
      TAG: 1.2.1
      KUSTOMIZATION: cluster/manifests/vpa/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/vpa/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  vpa-recommender:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/autoscaling/vpa-recommender
      TAG: 1.2.1
      KUSTOMIZATION: cluster/manifests/vpa/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/vpa/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  vpa-updater:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/autoscaling/vpa-updater
      TAG: 1.2.1
      KUSTOMIZATION: cluster/manifests/vpa/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/vpa/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  pyroscope:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: grafana/pyroscope
      TAG: 1.8.0
      KUSTOMIZATION: cluster/manifests/pyroscope/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/pyroscope/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  descheduler:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: registry.k8s.io/descheduler/descheduler
      TAG: v0.32.1
      KUSTOMIZATION: cluster/manifests/descheduler/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/descheduler/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  elasticsearch:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: elasticsearch
      TAG: 8.17.1
      KUSTOMIZATION: cluster/manifests/utilities/elasticsearch
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/elasticsearch/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  elasticsearch_exporter:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: quay.io/prometheuscommunity/elasticsearch-exporter
      TAG: v1.8.0
      KUSTOMIZATION: cluster/manifests/utilities/elasticsearch
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/elasticsearch/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  proxyv2:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: docker.io/istio/proxyv2
      TAG: 1.23.2
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  pilot:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: docker.io/istio/pilot
      TAG: 1.23.2
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  install-cni:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: docker.io/istio/install-cni
      TAG: 1.23.2
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  ztunnel:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: docker.io/istio/ztunnel
      TAG: 1.23.2
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  fluent-bit:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: fluent/fluent-bit
      TAG: 4.2.0
      KUSTOMIZATION: cluster/manifests/kube-crud-server/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/kube-crud-server/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  socat:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: alpine/socat
      TAG: latest
      KUSTOMIZATION: cluster/manifests/utilities/ext-proc-proxy
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/utilities/ext-proc-proxy/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  busybox:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: busybox
      TAG: 1.26.2
      KUSTOMIZATION: ""
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  telepresence:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: ghcr.io/telepresenceio/tel2
      TAG: 2.26.2
      KUSTOMIZATION: cluster/manifests/telepresence/base
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/telepresence/base/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
  mysqlclient:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: ubuntu-24.04
    env:
      IMAGE: tnir/mysqlclient
      TAG: latest
      KUSTOMIZATION: cluster/manifests/slack-logger/overlays/dev
    steps:
      - run: docker login ghcr.io -u ${GITHUB_REPOSITORY_OWNER} -p ${GITHUB_TOKEN}
      - uses: actions/checkout@v5
        with:
          sparse-checkout: |
            .github/workflows/bin/
            cluster/manifests/slack-logger/overlays/dev/
      - id: mirror
        run: bash .github/workflows/bin/mirror.sh
      - if: steps.mirror.outputs.pushed == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: pushed-${{ github.job }}
          path: ${{ runner.temp }}/pushed/
          if-no-files-found: ignore
          retention-days: 1
