name: loc
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:
    inputs: {}
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  tokei:
    if: github.repository_owner == 'kaidotio'
    timeout-minutes: 10
    runs-on: [self-hosted, github-actions-runner-controller]
    steps:
      - uses: actions/checkout@v6
      - run: |
          curl -sSL https://github.com/XAMPPRocky/tokei/releases/download/v12.1.2/tokei-x86_64-unknown-linux-gnu.tar.gz | tar zx --no-same-owner -C /tmp tokei
          # https://github.com/prometheus/statsd_exporter?tab=readme-ov-file#tagging-extensions
          /tmp/tokei . -o json | jq -r 'to_entries | map("loc,repository='${GITHUB_REPOSITORY}',type=\(.key):\(.value.code)|g") | .[]' | nc -w1 -u pushgateway-statsd.pushgateway-statsd.svc.cluster.local 9125
